import{b as v,r as x,j as e,L as o,y as d}from"./index-BLSGsmUJ.js";import{a as N,c as w}from"./appointmentAPi-C3Q3J_xr.js";const A=()=>{const{isAuthenticated:h,user:n}=v(t=>t.auth),[r,i]=x.useState("upcoming"),{data:a,isLoading:p,error:b,refetch:c}=N();x.useEffect(()=>{c()},[a,c]);const[g,{isLoading:m}]=w(),f=async t=>{const s=Number(t);if(isNaN(s)){console.error("Invalid appointment ID:",t),d.error("Failed to cancel appointment. Invalid ID.");return}try{await g(s).unwrap(),d.success("Appointment cancelled successfully!")}catch(l){console.error("Error cancelling appointment:",l),d.error("Failed to cancel appointment. Please try again.")}};if(!h||(n==null?void 0:n.role)!=="patient")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-50 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"You must be logged in as a patient to view your appointments."}),e.jsx(o,{to:"/login",className:"px-6 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",children:"Login"})]});if(p)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"animate-pulse flex space-x-2",children:[e.jsx("div",{className:"h-3 w-3 bg-blue-600 rounded-full"}),e.jsx("div",{className:"h-3 w-3 bg-blue-600 rounded-full"}),e.jsx("div",{className:"h-3 w-3 bg-blue-600 rounded-full"})]})});if(b)return e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 my-4 rounded shadow-sm",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:"Failed to load your appointments. Please try again later."})})]})});const u=(()=>{if(!a||a.length===0)return[];const t=new Date;return a.filter(s=>{const l=new Date(s.appointment_date);return r==="upcoming"?l>=t&&s.status!=="cancelled":r==="past"?l<t||s.status==="completed":r==="cancelled"?s.status==="cancelled":!0})})(),y=t=>{switch(t){case"confirmed":return"bg-green-100 text-green-800 border-green-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},j=t=>{const s=new Date(t);return new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)};return e.jsxs("div",{className:"max-w-4xl mx-auto mt-6 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"My Appointments"}),e.jsx(o,{to:"/doctors",className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 transition-colors",children:"Book New Appointment"})]}),a.some(t=>t.status==="pending")<0&&e.jsxs("div",{className:"mb-4 text-gray-600  ",children:["Hey ",e.jsx("span",{className:"font-semibold text-black",children:n.name}),", always come back to check the status of your appointments is complete after a successful payment."]}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{className:`py-4 px-1 border-b-2 font-medium text-sm ${r==="upcoming"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>i("upcoming"),children:"Upcoming"}),e.jsx("button",{className:`py-4 px-1 border-b-2 font-medium text-sm ${r==="past"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>i("past"),children:"Past"}),e.jsx("button",{className:`py-4 px-1 border-b-2 font-medium text-sm ${r==="cancelled"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>i("cancelled"),children:"Cancelled"})]})}),u.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No appointments"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r==="upcoming"?"You don't have any upcoming appointments. Check your status for recent bookings in the Past tab":r==="past"?"You don't have any past appointments.":"You don't have any cancelled appointments."})]}):e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsx("div",{className:"bg-white shadow-sm border border-gray-200 rounded-lg p-5 transition-all hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between",children:[e.jsxs("div",{className:"md:w-2/3",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Dr. ",t.doctor_name]})]}),e.jsxs("div",{className:"flex items-center mb-2 text-gray-600",children:[e.jsx("svg",{className:"h-5 w-5 text-gray-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:j(t.appointment_date)})]}),t.reason&&e.jsxs("p",{className:"text-gray-500 mb-3",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",t.reason]}),e.jsx("div",{className:"mb-3 md:mb-0",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${y(t.status)}`,children:t.status})})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:items-end mt-4 md:mt-0",children:[e.jsx(o,{to:`/appointments/${t.appointment_id}`,className:"inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 w-full md:w-auto text-center",children:"View Details"}),t.status==="pending"&&e.jsx("button",{onClick:()=>f(t.appointment_id),className:"inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 w-full md:w-auto disabled:opacity-50 disabled:cursor-not-allowed",disabled:m,children:m?"Cancelling...":"Cancel"}),t.status==="confirmed"&&e.jsx(o,{to:`/payments/${t.appointment_id}`,className:"inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 w-full md:w-auto text-center",children:"Pay Now"})]})]})},t.appointment_id))})]})};export{A as default};
