import{u as F,a as R,b as $,r as i,g as P,d as x,c as v,j as e,L,s as k,e as U,y as E}from"./index-CN3Tzird.js";import{u as q}from"./authApi-CgHeZS4o.js";import{a as A}from"./doctorApi-BX_uKyBA.js";const G=()=>{const o=F(),a=R(),{user:r}=$(t=>t.auth),[S,{isLoading:g}]=q(),[n,D]=i.useState({email:"",password:""}),[c,b]=i.useState("doctor"),{data:m,error:u}=A(r==null?void 0:r.doctorId,{skip:!(r!=null&&r.doctorId)});i.useEffect(()=>{m&&o(P(m)),u&&(console.error("Failed to load doctor profile:",u),o(x("Logged in, but failed to load doctor profile")))},[m,u,o]),i.useEffect(()=>{r&&(r.role==="admin"?a("/admin/dashboard"):r.role==="doctor"&&r.doctorId?a(`/doctor/dashboard/${r.doctorId}`):a("/")),o(v())},[r,a,o]);const f=t=>{D({...n,[t.target.name]:t.target.value})},I=async t=>{var p,y,w,j,N;t.preventDefault();const{email:l,password:h}=n;if(!l||!h){o(x("All fields are required."));return}try{o(k(!0)),o(v());const s=await S({email:l,password:h}).unwrap();if(console.log("Login response:",s),!(s!=null&&s.user))throw new Error("User data is missing in response.");const d={...s.user,doctorId:((y=(p=s.user)==null?void 0:p.doctor)==null?void 0:y.id)??null,doctor:((w=s.user)==null?void 0:w.doctor)??null};console.log("Updated user before setting Redux:",d),o(U(d)),localStorage.setItem("token",s.token),localStorage.setItem("user",JSON.stringify(d)),a(C(s.user.role,d.doctorId),{replace:!0}),E.success("Logged in successfully!")}catch(s){console.error("Login error:",s),o(x(((j=s.data)==null?void 0:j.message)||"Login failed. Please try again.")),E.error(((N=s.data)==null?void 0:N.message)||"Login failed. Please try again.")}finally{o(k(!1))}},C=(t,l)=>{switch(t){case"admin":return"/admin/dashboard";case"doctor":return l?`/doctor/dashboard/${l}`:"/doctor/profile/update";default:return"/dashboard"}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-bold text-gray-900",children:"Sign in to MediConnect"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Or"," ",e.jsx(L,{to:"/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"create a new account"})]})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[e.jsxs("div",{className:"flex border border-gray-300 rounded-md mb-6 overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>b("doctor"),className:`flex-1 py-3 px-4 font-medium focus:outline-none transition-colors ${c==="doctor"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Log in as Doctor"}),e.jsx("button",{type:"button",onClick:()=>b("admin"),className:`flex-1 py-3 px-4 font-medium focus:outline-none transition-colors ${c==="admin"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Log in as Admin"})]}),e.jsxs("form",{className:"space-y-6",onSubmit:I,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"email",name:"email",type:"email",required:!0,value:n.email,onChange:f,className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"password",name:"password",type:"password",required:!0,value:n.password,onChange:f,className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your password"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-700",children:"Remember me"})]}),e.jsx("div",{className:"text-sm",children:e.jsx(L,{to:"/forgot-password",className:"font-medium text-blue-600 hover:text-blue-500",children:"Forgot your password?"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:g,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-400",children:g?"Signing in...":`Sign in as ${c}`})})]})]})})]})};export{G as default};
